<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Visa multiplikation (10√ó10)</title>
  <style>
    :root { color-scheme: light; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: #f6f7f8;
      display: grid;
      place-items: center;
      min-height: 100vh;
    }
    .app {
      max-width: 880px;
      width: min(880px, calc(100vw - 32px));
      background: white;
      border: 1px solid rgba(0,0,0,0.12);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 6px 24px rgba(0,0,0,0.06);
      line-height: 1.25;
    }
    h2 { margin: 0 0 10px; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
    .badge {
      display: inline-flex;
      gap: 6px;
      align-items: center;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.14);
      background: rgba(0,0,0,0.03);
      font-size: 14px;
    }
    button {
      padding: 9px 12px;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.2);
      background: white;
      cursor: pointer;
    }
    button:active { transform: translateY(1px); }
    .hint { margin: 10px 0 8px; opacity: .85; }
    .feedback { margin: 12px 0 10px; opacity: .92; font-size: 15px; }

    .svgWrap {
      border: 1px solid rgba(0,0,0,0.12);
      border-radius: 12px;
      padding: 12px;
      display: inline-block;
      user-select: none;
      touch-action: none; /* viktigt f√∂r svep p√• mobil */
      color: #111; /* currentColor */
    }

    .selection circle {
      transition: opacity 120ms ease, transform 120ms ease;
      transform-origin: center;
    }
    .selection.pulse circle {
      opacity: 0.92;
      transform: scale(1.06);
    }
  </style>
</head>
<body>
  <div class="app">
    <h2>Visa multiplikation (10√ó10)</h2>

    <div class="row" style="margin-bottom:10px">
      <span class="badge" id="taskBadge"></span>

      <div class="row">
        <button id="btnNew">Ny uppgift</button>
        <button id="btnShow">Visa svar</button>
        <button id="btnClear">T√∂m</button>
      </div>
    </div>

    <div class="hint">
      Svep/klicka p√• rubrikerna (rader/kolumner) ‚Äì eller svep i rutan ‚Äì f√∂r att markera en rektangel.
    </div>

    <div class="row" style="margin-top:10px">
      <span class="badge" id="chosenBadge"></span>
    </div>

    <div class="feedback" id="feedback"></div>

    <div class="svgWrap">
      <svg id="svg" role="img"></svg>
    </div>
  </div>

<script>
(() => {
  const sv = {
    taskPrefix: "Uppgift:",
    taskShow: (r,c) => `Visa ${r} √ó ${c}`,
    correct: (r,c,n) => `Korrekt! üéâ ${r} √ó ${c} = ${n}`,
    notYet: "Inte riktigt √§n ‚Äî v√§lj r√§tt antal rader och kolumner.",
    aria: (r,c) => `10 g√•nger 10-ruta. Val: ${r} rader och ${c} kolumner.`
  };

  const gridN = 10;
  const cell = 34;
  const pad = 18;
  const header = 26;
  const dotR = 7;

  const w = pad * 2 + header + gridN * cell;
  const h = pad * 2 + header + gridN * cell;

  const svg = document.getElementById("svg");
  svg.setAttribute("width", w);
  svg.setAttribute("height", h);
  svg.setAttribute("viewBox", `0 0 ${w} ${h}`);

  const taskBadge = document.getElementById("taskBadge");
  const chosenBadge = document.getElementById("chosenBadge");
  const feedbackEl = document.getElementById("feedback");

  const btnNew = document.getElementById("btnNew");
  const btnShow = document.getElementById("btnShow");
  const btnClear = document.getElementById("btnClear");

  const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
  const randInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

  let targetRows = randInt(1,10);
  let targetCols = randInt(1,10);

  let selRows = 0;
  let selCols = 0;

  let isPointerDown = false;
  let dragMode = null; // "rows" | "cols" | "both"
  let pulseTimer = null;

  function triggerPulse() {
    svg.querySelectorAll(".selection").forEach(g => g.classList.add("pulse"));
    clearTimeout(pulseTimer);
    pulseTimer = setTimeout(() => {
      svg.querySelectorAll(".selection.pulse").forEach(g => g.classList.remove("pulse"));
    }, 130);
  }

  function setRowsSafe(n) {
    const next = clamp(n, 0, 10);
    if (next !== selRows) { selRows = next; triggerPulse(); render(); }
  }
  function setColsSafe(n) {
    const next = clamp(n, 0, 10);
    if (next !== selCols) { selCols = next; triggerPulse(); render(); }
  }

  function newTask() {
    targetRows = randInt(1,10);
    targetCols = randInt(1,10);
    selRows = 0; selCols = 0;
    render();
  }
  function clearSel() { selRows = 0; selCols = 0; render(); }
  function showAnswer() { selRows = targetRows; selCols = targetCols; render(); triggerPulse(); }

  btnNew.addEventListener("click", newTask);
  btnClear.addEventListener("click", clearSel);
  btnShow.addEventListener("click", showAnswer);

  function getLocalPoint(e) {
    const rect = svg.getBoundingClientRect();
    const x = clamp(e.clientX - rect.left, 0, rect.width);
    const y = clamp(e.clientY - rect.top, 0, rect.height);
    return { x: (x / rect.width) * w, y: (y / rect.height) * h };
  }

  function selectionFromPoint(mode, pt) {
    const gridX0 = pad + header;
    const gridY0 = pad + header;
    const gridW = gridN * cell;
    const gridH = gridN * cell;

    let nextRows = selRows;
    let nextCols = selCols;

    if (mode === "cols") {
      const relX = clamp(pt.x - gridX0, 0, gridW);
      nextCols = clamp(Math.ceil(relX / cell), 0, 10);
    } else if (mode === "rows") {
      const relY = clamp(pt.y - gridY0, 0, gridH);
      nextRows = clamp(Math.ceil(relY / cell), 0, 10);
    } else if (mode === "both") {
      const relX = clamp(pt.x - gridX0, 0, gridW);
      const relY = clamp(pt.y - gridY0, 0, gridH);
      nextCols = clamp(Math.ceil(relX / cell), 0, 10);
      nextRows = clamp(Math.ceil(relY / cell), 0, 10);
    }
    return { nextRows, nextCols };
  }

  function pointerUp() {
    isPointerDown = false;
    dragMode = null;
  }
  window.addEventListener("pointerup", pointerUp);
  window.addEventListener("pointercancel", pointerUp);

  svg.addEventListener("pointermove", (e) => {
    if (!isPointerDown || !dragMode) return;
    const pt = getLocalPoint(e);
    const { nextRows, nextCols } = selectionFromPoint(dragMode, pt);
    if (dragMode === "rows" || dragMode === "both") selRows = nextRows;
    if (dragMode === "cols" || dragMode === "both") selCols = nextCols;
    render();
  });

  function el(name, attrs = {}, children = []) {
    const n = document.createElementNS("http://www.w3.org/2000/svg", name);
    for (const [k, v] of Object.entries(attrs)) n.setAttribute(k, v);
    for (const ch of children) n.appendChild(ch);
    return n;
  }

  function render() {
    const targetCount = targetRows * targetCols;
    const builtCount = selRows * selCols;
    const isCorrect = (selRows === targetRows && selCols === targetCols);

    taskBadge.innerHTML = `${sv.taskPrefix} <b>${sv.taskShow(targetRows, targetCols)}</b>`;
    chosenBadge.innerHTML = `Valt: <b>${selRows} rader √ó ${selCols} kolumner = ${builtCount}</b>`;
    feedbackEl.textContent = isCorrect ? sv.correct(targetRows, targetCols, targetCount) : sv.notYet;

    svg.setAttribute("aria-label", sv.aria(selRows, selCols));

    // Rebuild SVG (enkel & robust f√∂r 10√ó10)
    while (svg.firstChild) svg.removeChild(svg.firstChild);

    svg.appendChild(el("rect", { x:0, y:0, width:w, height:h, rx:10, ry:10, fill:"white" }));

    // Column headers
    for (let c=0; c<gridN; c++) {
      const x0 = pad + header + c*cell;
      const y0 = pad;
      const isSel = c < selCols;

      const r = el("rect", {
        x:x0, y:y0, width:cell, height:header, rx:8,
        fill: isSel ? "currentColor" : "transparent",
        opacity: isSel ? 0.12 : 0,
        style: "cursor:pointer"
      });
      r.addEventListener("pointerdown", (e) => {
        e.preventDefault();
        isPointerDown = true;
        dragMode = "cols";
        setColsSafe(c+1);
      });

      const t = el("text", {
        x: x0 + cell/2, y: y0 + header/2 + 5,
        "text-anchor": "middle",
        "font-size": 13,
        fill: "currentColor",
        opacity: isSel ? 1 : 0.6,
        style: "pointer-events:none"
      });
      t.textContent = String(c+1);

      svg.appendChild(el("g", {}, [r, t]));
    }

    // Row headers
    for (let rI=0; rI<gridN; rI++) {
      const x0 = pad;
      const y0 = pad + header + rI*cell;
      const isSel = rI < selRows;

      const r = el("rect", {
        x:x0, y:y0, width:header, height:cell, rx:8,
        fill: isSel ? "currentColor" : "transparent",
        opacity: isSel ? 0.12 : 0,
        style: "cursor:pointer"
      });
      r.addEventListener("pointerdown", (e) => {
        e.preventDefault();
        isPointerDown = true;
        dragMode = "rows";
        setRowsSafe(rI+1);
      });

      const t = el("text", {
        x: x0 + header/2, y: y0 + cell/2 + 5,
        "text-anchor": "middle",
        "font-size": 13,
        fill: "currentColor",
        opacity: isSel ? 1 : 0.6,
        style: "pointer-events:none"
      });
      t.textContent = String(rI+1);

      svg.appendChild(el("g", {}, [r, t]));
    }

    // Cells
    for (let r=0; r<gridN; r++) {
      for (let c=0; c<gridN; c++) {
        const x = pad + header + c*cell;
        const y = pad + header + r*cell;
        const inSel = (r < selRows && c < selCols);

        const hit = el("rect", {
          x, y, width:cell, height:cell,
          fill: "transparent",
          style: "cursor:pointer"
        });
        hit.addEventListener("pointerdown", (e) => {
          e.preventDefault();
          isPointerDown = true;
          dragMode = "both";
          setRowsSafe(r+1);
          setColsSafe(c+1);
        });

        const dot = el("circle", {
          cx: x + cell/2,
          cy: y + cell/2,
          r: dotR,
          fill: inSel ? "currentColor" : "none",
          stroke: "currentColor",
          opacity: inSel ? 1 : 0.18,
          "stroke-width": 2,
          style: "pointer-events:none"
        });

        const g = el("g", { class: inSel ? "selection" : "" }, [hit, dot]);
        svg.appendChild(g);
      }
    }

    // Border
    svg.appendChild(el("rect", {
      x: pad + header,
      y: pad + header,
      width: gridN * cell,
      height: gridN * cell,
      fill: "none",
      stroke: "currentColor",
      opacity: 0.15,
      "stroke-width": 2,
      rx: 10
    }));

    if (isCorrect) {
      const ok = el("text", {
        x: pad + header + gridN*cell,
        y: pad + header - 6,
        "text-anchor": "end",
        "font-size": 14,
        fill: "currentColor"
      });
      ok.textContent = "‚úÖ";
      svg.appendChild(ok);
    }
  }

  render();
})();
</script>
</body>
</html>
